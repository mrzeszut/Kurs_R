---
title: "Wprowadzenie do programowania w R"
subtitle: "Podstawy programowania w R"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    html_document:
      theme: spacelab
      highlight: kate
      toc: true
      toc_float: true
      collapsed: false
      smooth_scroll: false
      number_sections: false
      toc_depth: 4
      self_contained: true
      code_folding: NULL
bibliography: moja_bib.bib
link-citations: yes
editor_options: 
  chunk_output_type: console
---

<style type="text/css"> 
body { font-size: 14px; text-align: justify} code.r{ font-size: 14px;} pre { font-size: 14px} 
h1   { font-size: 24px;} h2 { font-size: 22px;} h3 { font-size: 20px;} 
</style>

***

**Mateusz Rzeszutek** 

**AGH** Akademia Górniczo-Hutnicza im. Stanisława Staszica w Krakowie, Wydział Geodezji Górniczej i Inżynierii Środowiska, Katedra Kształtowania i Ochrony Środowiska.

**e-mail:** *[rzeszut@agh.edu.pl](rzeszut@agh.edu.pl)*.

**lokalizacja:**  bud. C-4, p. V, pok. 511, al. A. Mickiewicza 30, Kraków, Polska.

**konsultacje:** Zgodnie z informacjami na stronie
[dziekanatu](https://dziekanat.geod.agh.edu.pl/dziekanat/index.php?menu1=4&menu2=17&co=o&lin=o&wiad=@f_konsult_prez) lub po uzgodnieniu za pośrednictwem e-mail.

***

![](rys/logo_WGGiIS.jpg)

***

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=F,message=F,error=F)
```

***

# 4. Wczytywanie danych

***

## 4.1. Operacje na plikach i katalogach

Zanim zaczniemy wczytywać i zapisywać dane warto zapoznać się wstępnie z kilkoma funkcjami pakietu base, które służą do wykonywania operacji na plikach i katalogach. Najpierw przypomnienie dotyczące ustawienia katalogu domyślnego.

Teraz możemy wczytywać dane znajdujące się w katalogu domyślnym bez konieczności podawania pełnej ścieżki dostępu do pliku z danymi. Teraz sprawdzimy zawartość katalogu domyślnego. Mamy dwie opcje:

```{r}
getwd() ## zwraca informacje o aktualnym katalogu domyślnym
setwd("...") ## ustawia katalog domyślny 
```

Możemy zajrzeć do prawego dolnego okna Rstudio (zakładka Files) lub wpisać polecenie:
```{r, eval=F}
dir()
list.files() # j.w.
```

Korzystając z tego polecenia możemy otworzyć bardzo przydatny wektor, który można zastosować np.: w przypadku wczytywania danych z wielu plików danych. Utworzymy teraz wektor o nazwie pliki.

```{r, eval=FALSE}
pliki <- dir()
pliki
```

***

**Wykaz i opis wybranych funkcji** 

* `file.create(...)` - Funkcja tworzy pliki o zadanych nazwach, jeżeli takie pliki istnieją, to ich zawartość jest kasowana.
* `file.exists(...)` - Funkcja sprawdza czy pliki o zadanych nazwach istnieją.
* `file.remove(...)` - Funkcja usuwa pliki o zadanych nazwach (patrz też funkcja `unlink()`).
* `file.rename(from, to)` - Funkcja zmienia nazwę pojedynczego pliku.
* `file.append(file1, file2)` - Funkcja dokleja plik o nazwie file2 do pliku file1.
* `file.copy(from, to, overwrite=FALSE)` - Funkcja do kopiowania pliku z `from` w pozycje wskazaną przez argument `to`.
* `file.symlink(from, to)` - Funkcja do tworzenia linków symbolicznych (pod Unixami).
* dir.create(path, showWarnings=TRUE, recursive=FALSE) - Funkcja do tworzenia katalogów. Wynikiem tej funkcji jest wartość TRUE, jeżeli operacja utworzenia katalogu została wykonana pomyślnie. Jeżeli dany katalog już istnieje lub nie udało go się utworzyć funkcja przekazuje wartość FALSE.
* `file.info(...)` - Wynikiem tej funkcji są informacje o wskazanych plikach.
* `file_test(op, x, y)` - Funkcja do testowania plików. Dostępne testy to: jednoargumentowe (tylko x jest używane) op="-f" istnieje i nie jest katalogiem, op="-d" istnieje i jest katalogiem oraz dwuargumentowe op="-nt" jest młodszy niż (pod uwagę brane są daty modyfikacji) i op="-ot" jest starszy niż.
* `file.show(...)` - Funkcja wyświetla w oknie R zawartość jednego lub większej liczby plików.

***

**Przykłady**

W katalogu tematu drugiego powinienieś mieć dwa pliki tekstowe `im1.txt` oraz `im2.txt`. Otwórz je w notatniku, lub notepad++. Postaraj się by okno katalogu było otwarte. 

```{r, eval=F}
file.create("im3.txt")
file.create("im4.txt")
dir()
file.info("im1.txt")
file.info("im3.txt")
file.exists("im3.txt")
file.remove("im3.txt")
dir()
file.rename(from = "im4.txt", to = "im3.txt" )
dir()
file.remove("im3.txt")
file.append("im1.txt", "im2.txt")
## Teraz podglądnij w notatnik zawartość pliku im1.txt
file.copy(from = "im1.txt", to = "im3.txt", overwrite=FALSE)
dir.create("Twoje_Nazwisko", showWarnings=TRUE, recursive=FALSE)

```

***

## 4.2. Wczytywanie danych

W tym rozdziale omówimy metody wczytywania danych. Jest to dość proste i intuicyjne jednak wymaga znajomości rozszerzeń i typów plików. Jeśli wymienione w poniższym przykładzie rozszerzenia plików, programy nie są Państwu znane zachęcam do poczytania o nich. Akurat w tym wypadku Wikipedia jest wystarczającym źródłem informacji.

Dane mogą być przechowywane w najróżniejszych formatach, takich jak: 

* baza danych (Postgress, MySQL, Oracle), 
* plik tekstowy (.txt, .csv), 
* plik w formacie programu Excel (nowszym .xslx lub starszym .xls) 
* lub plik w formacie innego programu do analizy danych (SAS, SPSS, Statistica, itp).

W tym rozdziale odpowiemy na kilka zasadniczych pytań:

* Jak wczytywać dane tabelaryczne z plików tekstowych?
* Jak wczytywać dane tabelaryczne z plików Excela [xls lub xlsx]?
* Jak wczytywać dane z pakietów R?

Zawartość tego rozdziału nie jest wystarczająca, w przyszłości napewno będziecie korzystać z wielu różnych formatóW danych. Podstawowe informacje znajdziecie w rozdziale 3.1. [Przewodnik po pakiecie R 4.0](http://pbiecek.github.io/Przewodnik/). Bardzo prostym rozwiazaniem jest skorzystanie z wyszukiwarki google, gdzie wpisując np.: read shp in R, znajdziesz sporo informacji o wczytywaniu danych przestrzennych.

*** 

### 4.2.1. Dane w plikach tekstowych

Jednym z częstszych formatów używanych do przechowywania i wymiany danych są pliki tekstowe. Nazwa ‘plik tekstowy’ bierze się stąd, że treść tego pliku możemy otworzyć w standardowym edytorze takim jak Notepad/Notatnik w Windowsie lub vim w Linuxie/OSX. Pliki tekstowe można również otwierać z użyciem programu RStudio (uwaga, duże pliki mogą się długo otwierać). Jeżeli często pracujemy z dużymi lub wieloma plikami tekstowymi to warto wyposażyć się w dobre narzędzie do pracy z nimi, np. edytor Sublime Text i Notepad++.

Otwórz plik: `dane1_srednik.txt`

* pierwszy wiersz to nagłówek - zawiera nazwy kolumn rozdzielane średnikiem
* kolejne wiersze przedstawiają dane w postaci wektora wartości, które są rozdzielane znakiem `;`,
* w pliku występują liczby, które nie są liczbami całkowitymi - separatorem dziesiętnym jest znak `.`.

```{r}
getwd()
setwd("dane/") # wchodzę do foldera dane
getwd()
dir()
```

Instrukcja wczytująca dane do R składa się zazwyczaj z trzech członów. Ostatnim (po prawej stronie na poniższym schemacie) jest funkcja, która odczytuje dane, przetwarza i zamienia na postać zrozumiałą dla programu R.

Do wczytywania danych z pliku tekstowego posłużyć może funkcja `read.table()`. Ponieważ pliki tekstowe mogą mieć bardzo różną postać, funkcja ta ma wiele argumentów. Wybrane argumenty przedstawia poniższa deklaracja.
    
    read.table(file,
                header = FALSE,
                sep = "",
                dec = ".", 
                nrows = -1,
                skip = 0, comment.char = "#",
                stringsAsFactors = default.stringsAsFactors(), ...)


Ponieważ dane mogą być zapisane z użyciem różnych formatów, argumenty tej funkcji określają format danych do wczytania. Znaczenie kolejnych argumentów podane jest poniżej.

* `file` - ścieżka do pliku z danymi, może być też adres URL. Jeżeli wartości argumentów podajemy w ich domyślnej kolejności, to możemy pominąć nazwy argumentów (dlatego w kolejnych przykładach nie będziemy podawać nazwy tego argumentu).
* `header` - flaga określająca, czy pierwszy wiersz należy traktować jako nagłówek. W naszym przypadku header=TRUE.
* `sep` - znak rozdzielający kolumny. W naszym przypadku sep=";", ale popularnymi separatorami są również znak tabulacji (oznaczany \t), przecinek lub spacja. Separatorem może być dowolny, ale tylko jeden znak.
* `dec` - separator dziesiętny. Zazwyczaj jest to . lub ,. W naszym przypadku dec=",".
* `nrows` - maksymalna liczba wierszy do wczytania. Domyślnie ten argument przyjmuje wartość -1, czyli wczytaj wszystkie wiersze.
* `skip` - liczba pierwszych wierszy do pominięcia przy wczytywaniu danych, domyślnie 0, czyli nie pomijaj żadnego wiersza.
* `comment.char` - znak komentarza. Jeżeli w danych wystąpi ten znak to treść od tego znaku do końca linii będzie zignorowana.
* `stringsAsFactors` - czy napisy powinny być domyślnie przekształcone w zmienne jakościowe. Domyślnie TRUE.

Wynikiem funkcji read.table() jest tabelaryczny zbiór danych, który w R nazywa się ramką danych (ang. data.frame). 

***

**Pierwszy przykład** 

**UWAGA:** sprawdźć ścieżka dostępu do lokalizacji twojego pliku.

```{r}
dane <- read.table(file = "Z:/R/Kurs_R/dane/dane1_srednik.txt", # lokalizacja i nazwa pliku
                   header = TRUE, # czy zawiera nazwy kolumn
                   sep = ";", # separtor wartosci
                   dec=".") # separator miejsca dzisiętnego
```

```{r, eval=F}
dane 
View(dane)
```


**Drugi przykład:**

Najpierw polecenie `setwd()` ustaw ścieżkę dostępu do katalogu.

```{r}
setwd("Z:/R/Kurs_R/dane/") # To nie jest twoja ścieżka
getwd()
```

Z powodzeniem wczytaliśmy dane, jeśli nie to sprawdźć ścieżke katalogu.

```{r}
dane2 <- read.table(file = "dane2_przecinek.txt", # lokalizacja i nazwa pliku
                   header = TRUE, 
                   sep = ",", # przecinek  
                   dec=".")
```

```{r, eval=F}
dane2 
```

**Trzeci przykład:**

Otwórz plik "dane3_brudny.txt" w notatniku. Zauważ, że kilka wierzy danych jest nieprawidłowych.Dokłądnie są to wiersze od 1 i 2. Pomijamy je za pomocą argumentu `skip`.

```{r}
dane3 <- read.table(file = "dane3_brudny.txt", # lokalizacja i nazwa pliku
                   header = TRUE, 
                   sep = ";",  
                   dec=".", skip = 2)
```

```{r, eval=F}
dane3 
```

**czwarty przykład:**

Funkcją `read.table()` można wczytać również pliki .csv. Otwórz plik "dane1_srednik.csv" w w notatniku.

```{r}
dane4 <- read.table(file = "dane1_srednik.csv", # lokalizacja i nazwa pliku
                   header = TRUE, 
                   sep = ";",  
                   dec=".")
```

lub funkcja `read.csv`:

```{r}
read.csv("dane1_srednik.csv", sep = ";") -> dane6
```

Pliki można też pobierać za posrednictwem adresu internetowego.

```{r}
dane7 <- read.table(file = "http://biecek.pl/MOOC/dane/koty_ptaki.csv", 
                    sep=";", dec=",", header=TRUE)

read.csv(file = "http://biecek.pl/MOOC/dane/koty_ptaki.csv", sep = ";") -> dane7
```

***

### 4.2.2. Wczytywanie plików xlsx.

Aby wczytać pliki xlsx, lub xls trzeba zainstalować i załadować pakiet `openxlsx`

```{r, eval=FALSE}
install.packages("openxlsx")
```

```{r}
library(openxlsx)
```

W folerze dane znajduje się plik, który składa się z dwóch arkuszy danych. Najpierw wczytamy arkusz dane, a potem arkusz koty_ptaki.

```{r}
openxlsx::read.xlsx("dwa_arkusze.xlsx", sheet = 1) -> dane
dane
```

Teraz drugi arkusz:

```{r}
read.xlsx("dwa_arkusze.xlsx", sheet = 2) -> zwierz
zwierz
```


***

### 4.2.3. pliki binarne

Natywnym formatem dla programu R są pliki binarne o rozszerzeniu `.rda` lub `.RData`. Dane w tym formacie są skompresowane, przez co zajmują mniej miejsca na dysku niż w pliku tekstowym lub formacie Excela. Wadą jest to, że niewiele programów poza programem R potrafi je odczytać.

Dane w tym formacie można wczytać do programu R poleceniem `load()`. Pierwszym argumentem tej funkcji jest ścieżka do pliku z danymi. Jeżeli chcemy dane odczytać z internetu, należy dodatkowo użyć funkcji `url()`.

Uwaga !!! W przeciwieństwie do wcześniej poznanych funkcji, funkcja `load()` nie zwraca zbioru danych jako wynik, ale ładuje zbiór danych bezpośrednio do przestrzeni nazw (dane zapisane są wraz z nazwą zmiennej). 

```{r}
load(url("http://biecek.pl/MOOC/dane/koty_ptaki.rda"))
load("dane.RData")
```

***

## 4.3. Zapisywanie danych 

Zapisywanie danych przebiega w sposób analogiczny. Funkcję różnią się z reguły nazwą, zamiast `read` jest `write`. Przykłady:

```{r}
getwd() # tu zapisujemy
write.table(dane, file = "write1.txt",  # txt
            sep = ";", dec = ".", 
            row.names = F, col.names = T)

write.table(dane, file = "write2.csv",  # csv
            sep = ",", dec = ".", 
            row.names = F, col.names = T)

write.csv(dane, file = "write3.csv", row.names = F)

write.xlsx(zwierz, file = "zwierz.xlsx")

save(dane, dane2, zwierz, koty_ptaki,
     file = "dane_all.RData") # można od razu zapisać kilka 
```

***





